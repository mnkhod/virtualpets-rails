<h1>Chat With
  <%= @pet.name %></h1>

<%= turbo_stream_from :pet_image_update %>

<div id="pet_avatar_<%= @pet.id %>">
  <% if @pet.avatar.attached? %>
    <%= image_tag @pet.avatar.representation(resize_to_limit: [250, 250]) %>
    <%# render "fragments/pet_image", locals: { pet: @pet } %>
  <% else %>
    <p>avatar still generating...</p>
  <% end %>
</div>

<ul>
  <li>Personality -
    <%= @pet.personality %></li>
  <li>Gender -
    <%= @pet.gender %></li>
  <li>Phrase -
    <%= @pet.phrase %></li>
  <li>Hunger -
    <%= @pet.hunger %></li>
  <li>Age -
    <%= @pet.age %></li>
  <li>Level -
    <%= @pet.level %></li>
  <li>Conversation Length -
    <%= @conversations_length %></li>
</ul>

<main style="width:50%">
  <fieldset>
    <% if @messages.any? %>
      <% @messages.each do |message| %>

        <% if message.role == "user" %>
          <p style="text-align: right;">
            <i>
              <%= tag.mark message.content %>
            </i>
          </p>
        <% end %>

        <% if message.role == "assistant" %>
          <p style="text-align: left;">
            <%= tag.i "#{@pet.name}: #{message.content}" %>
          </p>
        <% end %>

        <% if message.role == "assistant" %>
        <% end %>

      <% end %>
    <% end %>
  </fieldset>

  <%= form_with model: @chat, url: pet_chat_path(@pet) do |f| %>
    <fieldset>
      <%= f.text_field :question, style: "width:90%" %>
      <%= f.submit "Send" %>
    </fieldset>
  <% end %>
</main>

<%= link_to "Go Back", pets_path %>
